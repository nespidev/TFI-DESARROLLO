<div *ngIf="!cargando && encuesta">
  <h2>{{ encuesta.nombre }}</h2>

  <form (ngSubmit)="enviarEncuesta()">
    <div *ngFor="let pregunta of encuesta.preguntas">
      <label>{{ pregunta.numero }}. {{ pregunta.texto }}</label>

      <ng-container [ngSwitch]="pregunta.tipo">
        <!-- ABIERTA -->
        <input
          *ngSwitchCase="'ABIERTA'"
          [(ngModel)]="respuestas[pregunta.numero]"
          name="pregunta-{{pregunta.numero}}"
        />

        <!-- SELECCIÓN SIMPLE -->
        <div *ngSwitchCase="'OPCION_MULTIPLE_SELECCION_SIMPLE'">
          <div *ngFor="let opcion of pregunta.opciones">
            <input
              type="radio"
              [name]="'pregunta-' + pregunta.numero"
              [value]="opcion.texto"
              [(ngModel)]="respuestas[pregunta.numero]"
            />
            {{ opcion.texto }}
          </div>
        </div>

        <!-- SELECCIÓN MÚLTIPLE -->
        <div *ngSwitchCase="'OPCION_MULTIPLE_SELECCION_MULTIPLE'">
          <div *ngFor="let opcion of pregunta.opciones">
            <input
              type="checkbox"
              (change)="onCheckboxChange(pregunta.numero, opcion.texto, $any($event.target).checked)"
            />
            {{ opcion.texto }}
          </div>
        </div>

        <!-- VERDADERO/FALSO -->
        <div *ngSwitchCase="'VERDADERO_FALSO'">
          <label>
            <input
              type="radio"
              [name]="'pregunta-' + pregunta.numero"
              value="Verdadero"
              [(ngModel)]="respuestas[pregunta.numero]"
            />
            Verdadero
          </label>
          <label>
            <input
              type="radio"
              [name]="'pregunta-' + pregunta.numero"
              value="Falso"
              [(ngModel)]="respuestas[pregunta.numero]"
            />
            Falso
          </label>
        </div>

        <!-- NUMÉRICO -->
        <div *ngSwitchCase="'NUMERICA'">
          <label>Mínimo: {{ pregunta.minimo ?? 1 }}</label>
          <label>Máximo: {{ pregunta.maximo ?? 10 }}</label>
          <input
            type="number"
            [(ngModel)]="respuestas[pregunta.numero]"
            [min]="pregunta.minimo ?? 1"
            [max]="pregunta.maximo ?? 10"
            name="pregunta-{{pregunta.numero}}"
          />
        </div>
      </ng-container>

      <hr />
    </div>

    <label for="tipoPregunta">Tipo de pregunta:</label>
    <select id="tipoPregunta" [(ngModel)]="tipoSeleccionado" name="tipoPregunta">
      <option *ngFor="let tipo of tiposRespuesta" [value]="tipo.tipo">
        {{ tipo.nombre }}  
      </option>
    </select>

    <button type="button" (click)="agregarPregunta(tipoSeleccionado)">Agregar pregunta</button>
    <button type="submit">Enviar encuesta</button>
  </form>

  <p *ngIf="mensaje">{{ mensaje }}</p>
</div>
